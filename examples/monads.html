<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Monads — Kotlinify</title>
    <style>
      body {
        margin: 0;
        min-height: 100vh;
        display: grid;
        place-items: center;
        padding: 36px;
        background: linear-gradient(135deg, #111827, #312e81);
        font-family: 'Inter', system-ui, sans-serif;
        color: #f8fafc;
      }
      main {
        width: min(760px, 94vw);
        background: rgba(17, 24, 39, 0.94);
        border-radius: 24px;
        padding: 32px;
        box-shadow: 0 32px 90px rgba(30, 64, 175, 0.45);
      }
      h1 {
        margin: 0 0 12px;
        font-size: 2.2rem;
      }
      p {
        margin: 0 0 20px;
        opacity: 0.9;
        line-height: 1.6;
      }
      .card {
        background: rgba(30, 41, 59, 0.8);
        border-radius: 16px;
        padding: 18px;
        margin-bottom: 18px;
      }
      pre {
        margin: 0;
        white-space: pre-wrap;
        word-break: break-word;
      }
      button {
        border: none;
        border-radius: 12px;
        padding: 12px 18px;
        font-weight: 600;
        cursor: pointer;
        background: linear-gradient(135deg, #f97316, #facc15);
        color: #1f2937;
      }
    </style>
  </head>
  <body>
    <main>
      <h1>Null Safety &amp; Railway-Oriented Flow</h1>
      <p>
        Kotlinify monads let you collapse nullable checks and error branches into fluent pipelines. No
        more pyramid of doom.
      </p>
      <div class="card">
        <h2 style="margin-top:0">Option – Enrich a Maybe-User</h2>
        <pre id="optionOutput">Click "Evaluate" to run the pipeline…</pre>
      </div>
      <div class="card">
        <h2 style="margin-top:0">Result &amp; Either – Safe Email Campaign</h2>
        <pre id="resultOutput">Waiting for evaluation…</pre>
      </div>
      <button id="run">Evaluate</button>
    </main>
    <script src="https://unpkg.com/kotlinify-ts@latest/dist/index.global.js"></script>
    <script>
      const { Some, None, Option, Success, Failure, Right, Left } = kotlinify;

      const users = [
        { id: '42', name: 'Ada Lovelace', email: 'ada@analytics.dev', tier: 'pro' },
        { id: '7', name: 'Grace Hopper', email: 'grace@navy.mil', tier: 'enterprise' },
      ];

      const campaigns = {
        pro: { subject: 'Pro tips unlocked', quota: 5000 },
        enterprise: { subject: 'Enterprise command center', quota: 20000 },
      };

      const findUser = (id) => {
        const match = users.find((u) => u.id === id);
        return match ? Some(match) : None();
      };

      const loadCampaign = (tier) => {
        const campaign = campaigns[tier];
        return campaign ? Success(campaign) : Failure(new Error('Unknown tier'));
      };

      const validateEmail = (email) =>
        email.includes('@') ? Right(email.toLowerCase()) : Left('Invalid email address');

      document.getElementById('run').addEventListener('click', () => {
        const optionResult = findUser('42')
          .map((user) => ({
            ...user,
            initials: user.name
              .split(' ')
              .map((part) => part[0])
              .join(''),
          }))
          .map((user) => ({
            ...user,
            campaign: campaigns[user.tier],
          }))
          .map((user) => ({
            greeting: `Hey ${user.name}!`,
            campaign: user.campaign?.subject ?? 'Stay tuned',
          }))
          .getOrElse({ greeting: 'User not found', campaign: 'n/a' });

        document.getElementById('optionOutput').textContent = JSON.stringify(optionResult, null, 2);

        const userResult = findUser('7').fold(
          () => Failure(new Error('Missing user')),
          (user) => Success(user)
        );

        const result = userResult
          .flatMap((user) => loadCampaign(user.tier))
          .map((campaign) => ({
            ...campaign,
            audience: users.map((u) => validateEmail(u.email)),
          }))
          .map((campaign) => ({
            subject: campaign.subject,
            validEmails: campaign.audience
              .filter((entry) => entry.isRight)
              .map((entry) => entry.getOrNull()),
          }));

        document.getElementById('resultOutput').textContent = result.fold(
          (error) => `Campaign failed: ${error.message}`,
          (campaign) => `Subject: ${campaign.subject}\nRecipients: ${campaign.validEmails.join(', ')}`
        );
      });
    </script>
  </body>
</html>
